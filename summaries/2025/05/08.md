# Activity Summary for 5/8/2025

## 12:20:12 AM
The log shows multiple revisions to `autoAccounts.controller.js` between May 7th and May 8th, 2025.  The core functionality remains consistent throughout:  auto-assigning orders to available "Accounts" users based on their current workload.  The algorithm finds the "Accounts" user with the fewest uncompleted orders and assigns the new order to them, updating the order's status to "accounts_pending" and logging the change.  The assigned user's ID and name are returned.

The primary changes across revisions involve the order notification mechanism:

* **Initial Revisions (May 7th, 11:56 PM and 11:58 PM):** The `sendAssignmentNotification` function was used (although its implementation is just a placeholder log message), and `socketManager` and `notification` models were included as dependencies initially.
* **May 8th Revisions (12:01 AM, 12:03 AM, 12:06 AM):**  The code progressively refactored the notification system. The `socketManager` dependency was removed.  `notifyOrderUpdated` from `../service/websocketStatus` was introduced and then commented out in subsequent versions. It seems like there was experimentation with different notification methods, possibly switching between a custom function and a websocket-based approach.  The final revision (12:17 AM) reverted to the original `sendAssignmentNotification` function without websocket notification.

In summary, the core order assignment logic remained unchanged.  The most significant changes were related to experimenting with different notification strategies. The final version employs a simple placeholder notification function (`sendAssignmentNotification`).


## 1:20:18 AM
The log shows multiple revisions to the backend code of a system managing orders, primarily focusing on websocket notifications and automated order assignments.  The `websocketStatus.js` file underwent the most revisions,  with changes concentrated between 12:29 AM and 12:53 AM.  These changes primarily involve refining the notification system to provide updates to admins and assigned users for order status changes and assignments,  including details of what changed in the order.  The notification creation consistently uses the `notification.create` method, sending various socket events ("changeStatus", "newNotification", "orderUpdated", "orderAssigned") depending on the action. The notification text is dynamically generated based on order ID, status changes, and user names.


The `autoAccounts.controller.js` and `autoCutout.controller.js` files manage automated order assignment to "Accounts" and "Cutout" users, respectively.  Both controllers follow a similar pattern: finding available users based on account type and order count, assigning the order, updating order status ("accounts_pending" or "cutout_pending"), creating log entries, and sending a notification using the `sendAssignmentNotification` function from `websocketStatus.js`. The logic in these files remained relatively stable after the initial commits.

The `cutout.controller.js` file handles order assignments to cutout users and order status updates. It includes a function for retrieving CAD files associated with an order. This file shows  a function `sendAssignmentNotification` which is later replaced by the  more robust function in  `websocketStatus.js`.  The `changeStatusByCutout` function is used for updating order status via websockets.

The `graphics.controller.js` file manages order creation, including image uploads, user assignment, and work queue management. The majority of the changes are in creating the `createOrder` function.  A commented-out version of the `createOrder` function existed, showcasing iterative development.  The active version introduces a transactional approach using `mongoose.startSession()` to ensure data consistency. The final version includes a function `sendAssignmentNotification`.

In summary, the changes reflect a focus on improving the real-time notification system through websockets and implementing automated order assignment logic to improve workflow efficiency.  The `websocketStatus.js` file acts as a central hub for managing these notifications.  The frequent updates to `websocketStatus.js` suggest an ongoing effort to improve the notification system's functionality and reliability.


## 11:17:52 AM
The `InviteTutors.js` component underwent several revisions between 11:05 AM and 11:09 AM on May 8, 2025.  The primary changes involved fetching and displaying tutor data. Initially, the component used mock tutor data.  The updated version fetches tutor data using `axiosInstance.get('/tutor/search/by-subject')`, passing `userId`, `subjectId`, and `subjectName` as parameters and including a `jwtToken` in the headers for authentication.  The fetched data is then mapped to a format suitable for the `TutorCard` component. Error handling is included, falling back to mock data if the API call fails.  A search functionality was added, allowing users to filter tutors by name or description.  Furthermore, a sorting mechanism was implemented, enabling users to sort tutors by relevance, price (lowest to highest, highest to lowest), and date (latest first).  The sorting logic is handled within the `handleSortSelect` function, using a switch statement.  Finally, additional console logs were added for debugging purposes, notably in the `fetchTutorsBySubject` function.  The changes between each timestamp are incremental refinements to the fetching, error handling, and logging aspects of the tutor data retrieval and display.


## 12:17:52 PM
The `InviteTutors.js` component underwent a significant revision between May 8th, 2025, 12:04:30 PM.  The initial version was a static component rendering tutor cards from a local `tutors` array. The updated version fetches tutor data dynamically using `axiosInstance` based on `subjectId` and `userId`, retrieved from the auth context and cookies.  Error handling is included; if the API request fails, mock data is used.  The updated component now includes:

* **Dynamic Data Fetching:** Uses `axiosInstance` to retrieve tutors based on subject ID and user ID, replacing the static `tutors` array.  The API endpoint used is `/tutor/search/by-subject`. JWT token authentication is implemented using headers.

* **Search Functionality:**  A search bar allows filtering tutors by name and description.

* **Sorting Functionality:**  A sorting mechanism is added, allowing users to sort tutors by relevance, price (low to high, high to low), and last seen/updated date.  This functionality uses a modal controlled by `showSortModal` and `sortModalRef`.

* **Loading Indicator:** An `isLoading` state variable manages a loading indicator while fetching data.

* **Error Handling:** Includes `try...catch` block to handle API errors, and gracefully defaults to mock data in case of failure.  It also uses `sonner` for displaying error toasts.

* **Data Mapping:** A `mapApiTutorToCardFormat` function transforms the API response data into a format suitable for the `TutorCard` component. This function handles optional fields gracefully and calculates experience years.

* **Improved UI:** While the overall structure remains similar, the implementation significantly enhances the data management and user interaction aspects of the component.  The component also leverages cookies to store and retrieve `jwtToken` and `userId`.


## 2:25:43 PM
The log shows two updates to `CutoutOrder.jsx` within a short time frame (5/8/2025, 12:43:24 PM and 5/8/2025, 12:43:47 PM).  The content of the file remains identical in both versions.

A separate log entry shows a change to `invoice.model.js` (5/8/2025, 12:02:44 PM). This file defines a Mongoose schema for invoices.  Key features include:

* **Automatic Invoice Number Generation:** A pre-save hook generates unique invoice numbers in the format `BSCS-YY-MM-NNNNN` using a counter collection.
* **Comprehensive Invoice Data:** The schema includes fields for order details, customer information, itemized items, tax calculations, addresses, and creation timestamps.  GST calculations (CGST and SGST) are included with default values.
* **Data Validation:**  The schema uses Mongoose's validation features (`required`, `unique`) to ensure data integrity.

There are no apparent patterns or recurring elements beyond the standard structure and functionality common to Mongoose schema definitions within the provided logs.
