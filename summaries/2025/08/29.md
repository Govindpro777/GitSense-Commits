# Activity Summary for 8/29/2025

## 10:02:12 AM
The primary change on August 29th, 2025, at 9:28:20 AM, involved updating `c:\Users\91965\Desktop\ScribeIntern\Backend\Skribe-Backend\src\services\api.ts`. This file contains an Axios instance configured for API interaction.  The update focuses heavily on refining the error handling and token refresh mechanism.

Specifically, the code now includes improved handling of network errors, displaying a toast message instead of an alert.  The most significant addition is a robust implementation of access token refresh upon receiving a 401 (Unauthorized) response. This involves checking for an existing refresh attempt (`isRefreshing`), making a refresh token request to `/Authenticate/refresh-token`, updating local tokens upon success, and retrying the original request.  If refresh fails, the user is redirected to the login page (`/`).  Multiple base URLs are commented out, suggesting recent changes in deployment environment.  The `X-Source-App` header is set to `BackendApp`.  The code utilizes `Alert` components (presumably for UI feedback) and `TokenService` for managing access and refresh tokens.


## 10:02:56 AM
The `Customers.jsx` file was updated on August 29, 2025, at 9:38:15 AM.  This component displays a list of customers, allowing for searching, adding, editing, and deleting entries.  The component fetches customer data via an API call to  `${BASE_URL}/api/v1/admin/getAllCustomers` using an authorization token stored in localStorage.  The API endpoints used include `/api/v1/admin/createCustomer`, `/api/v1/admin/updateCustomer/{customerId}`, and `/api/v1/admin/deleteCustomer/{customerId}` for CRUD operations.

The code implements client-side filtering based on search terms across various customer fields (name, email, phone, GST, PAN).  It uses React's useState hook extensively to manage component state, including customer data, modal visibility, form data, loading status, and the currently selected customer for editing. Error handling is included using `react-hot-toast` for displaying success and error messages to the user. The UI is built using a table structure with a search bar and buttons for adding new customers.  Modals are used for creating and editing customer information, with form validation ensuring required fields are filled.  The component leverages `lucide-react` for icons and `axios` for API interactions.


## 1:20:02 PM
The log shows updates to two files: `order.model.js` and `graphics.controller.js`.

**`order.model.js` (8/29/2025, 11:27:24 AM):** This file defines a Mongoose schema for an `Order` model.  Significant changes include the addition of a pre-save hook to auto-generate unique `orderId` values using a `Counter` model. The schema also includes fields for customer information, order requirements, dimensions, status (with various stages like `graphics_pending`, `admin_approved`, etc.), images, assigned and approved users, and timestamps.  The spelling in the code was also corrected.


**`graphics.controller.js` (Multiple updates):** This file contains controllers for handling graphics-related operations. Multiple updates occurred between 11:29:03 AM and 11:41:50 AM, all focusing on the `createOrder` function.  Initially, the `createOrder` function was commented out.  Later versions progressively developed the functionality to create an order, including:

* **Input Validation:** Added validation to ensure `requirements`, `dimensions`, and `images` are provided.
* **Customer Handling:** Implemented checks to handle both existing and new customers. If a `customerId` is provided, it verifies the customer exists before proceeding. Otherwise, it implies creating a new customer (though this part of the code is truncated).
* **File Uploads:**  Uses a `localFileUpload` utility to handle image uploads.
* **User Assignment:** The controller attempts to find an available 'Graphics' user using aggregation queries. If `assignedTo` is provided then it uses that id else it assigns an available user.
* **Work Queue Management:**  Creates a `WorkQueueItem` entry linked to the new order.
* **Task Scheduling:** Uses `agenda` to schedule an order processing job.
* **Transaction Management:** Uses Mongoose transactions to ensure atomicity of order and work queue creation.
* **Notification System:** Sends a notification to the assigned user via socket using a `sendAssignmentNotification` function, leveraging a `socketManager`.

The `createOrder` function evolved from a fully commented-out state to a robust function handling order creation, user assignment, work queue management, and notifications within a transactional context.  The multiple revisions suggest iterative development and debugging of the order creation process.  Helper functions for finding available users, calculating priority, and estimating completion time are also defined.  A pattern of using promises and async/await for asynchronous operations is consistently used throughout the controller.


## 4:20:00 PM
The log shows code changes across three files related to a lead management system.

**`lead.model.js` (8/29/2025, 4:16:17 PM):**  This file, a Mongoose schema for leads, was updated to make the `email` field optional and no longer unique.  The `phone` field, however, is now required and must be unique.  No other significant changes were made to the schema structure.

**`lead.controller.js` (8/29/2025, 4:16:57 PM and 8/29/2025, 4:17:05 PM):**  This file, containing controllers for lead management, underwent multiple revisions. Initially, all fields (firstName, lastName, email, phone) were required for lead creation.  This was later relaxed to only require firstName, lastName and phone, while email became optional.  A key change was shifting from email uniqueness validation to phone number uniqueness validation when creating and updating leads.  The controller also includes functions for updating, deleting, and converting leads to customers, and fetching all leads (excluding those converted to customers).

**`Leads.jsx` (8/29/2025, 4:17:51 PM):** This React component displays and manages leads. It fetches leads from an API endpoint (`/api/v1/admin/getAllLeads`), provides filtering and searching by name, email, phone, and status, and includes functionalities for adding, editing, converting, and deleting leads. The component uses React's `useState` and `useEffect` hooks for managing state and fetching data.  It incorporates a notification system to inform the user about success or failure of actions.  The UI incorporates a table to show the leads and buttons for actions such as adding, editing, converting and deleting.


## 5:06:47 PM
The log shows multiple revisions to two React component files: `CampaignSummary.jsx` and `CampaignArticles.jsx`.  `CampaignDetail.jsx` also received updates.

`CampaignSummary.jsx` underwent several revisions between 3:06 PM and 3:09 PM, primarily involving minor text corrections within the UI rendering section.  The core functionality of fetching and displaying campaign summaries, handling search, and pagination remained unchanged.  The component fetches campaign data using `userService.get(url)` and displays it using `SummaryRecord` components.  A search feature filters campaigns based on `vchCampaignName`.  A "Load more" button implements pagination using `nextPageToken`.


`CampaignArticles.jsx` underwent significant changes between 3:14 PM and 4:54 PM. Initially, the component was fully functional, fetching articles based on campaign ID, keywords, topics, and a specified date range.  The date range was initially calculated to be 30 days from the `campCreatedDate`.  Between 3:33 PM and 4:54 PM, the entire code within the component was repeatedly commented out. This suggests a potential temporary removal of the component's functionality or a significant refactoring process, possibly due to debugging or a planned rewrite.  The component uses `userService.post()` to fetch articles.


`CampaignDetail.jsx` was updated between 3:08 PM and 3:10 PM. These updates primarily involved correcting minor typos in the UI, specifically in the navigational elements. The core functionality of fetching and displaying campaign details, stats, and articles remained consistent.  The component makes separate API calls using `userService.get()` for campaign stats, tracking data, and keywords.  Error handling is present, displaying warnings or errors based on API responses.


## 5:19:57 PM
The log shows a single code change to `c:\Users\91965\Documents\GitHub\M\M_Backend\models\lead.model.js` at 8/29/2025, 4:50:40 PM.  This change modifies the `lead` Mongoose schema.  Specifically, the email field is updated to be optional and allow duplicates, while the phone field is now required and must be unique.  A `pre-save` middleware function is added to automatically generate the `name` field from `firstName` and `lastName`.  The `status` field uses an enum for better data validation and defaults to "New".  The overall change improves data integrity and consistency within the `Lead` model.
