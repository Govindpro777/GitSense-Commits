# Activity Summary for 1/18/2026

## 1:42:58 PM
**File: `c:\Users\91965\Desktop\MikeLegal\clm-frontend\apps\MikeCLM\src\components\Contracts\Files\Files.tsx`**
This file, central to contract file management, underwent significant and iterative changes.
*   **Initial Setup (1/16/2026, 3:08:21 PM)**: The component was established with basic file display, search, sort, selection, download, and delete functionalities. It utilized Ant Design components and mock `FilesListItem` data, managing UI states locally.
*   **API Integration Preparation (1/16/2026, 6:00:06 PM - 6:00:25 PM)**: Minor changes were introduced to retrieve `access_token` from `localStorage` and log it, hinting at upcoming backend integration.
*   **Major Refactor for Dynamic Data Fetch (1/17/2026, 11:43:50 AM)**: The component was heavily refactored. The hardcoded file list was replaced with dynamic data fetching using `axios` and `useEffect`. It began extracting a `document_id` from URL search parameters (`useSearchParams`) to fetch specific contract documents from `${ROOT_URL}/contract-documents`, including an authorization header with the `access_token`. The `FilesListItem` interface was slightly modified.
*   **Apparent Rollback and Re-refactor (1/17/2026, 11:47:21 AM - 3:03:06 PM)**: The code briefly reverted to using hardcoded file data, removing the `axios` and `useSearchParams` imports. However, this was quickly undone, and subsequent changes re-introduced and stabilized the API-driven fetching logic. During this period, `useRef`, `useOnlineStatus`, and `useDispatch` (for Redux integration) were added, and the import path for `useOnlineStatus` was corrected iteratively. Integration with Redux for error handling (`setError` from `@mike-clm/shared`) was also implemented.
*   **Further Shared Utility Integration (1/17/2026, 3:24:24 PM - 4:13:59 PM)**: Additional imports from the `@mike-clm/shared` library were added, including `useUserData` and `convertDate`. A new type `LoaderType` was introduced, suggesting a more robust loading state management system.

**File: `c:\Users\91965\Desktop\MikeLegal\clm-frontend\apps\MikeCLM\src\containers\Calendar\Calendar.tsx`**
*   **Initial Structure and Filter Logic (1/16/2026, 5:08:58 PM)**: The `Calendar` container was set up to manage event filters (contract start, end, renewal, execution, obligation) and team filters using Redux (`useSelector`, `useDispatch`) and local state (`useState`). It featured "Apply" and "Reset" filter buttons. Notably, the main `CalendarModule` component was initially commented out within the JSX.
*   **Calendar Module Activation (1/16/2026, 5:09:13 PM)**: Shortly after, the `CalendarModule` component was uncommented, integrating it into the UI and passing down the managed filter states, enabling the visual calendar functionality.

**File: `c:\Users\91965\Desktop\MikeLegal\clm-frontend\apps\MikeCLM\src\components\Contracts\Files\FileManagerGrid.tsx`**
*   **Temporary Comment Out (1/17/2026, 11:44:29 AM)**: The entire `FileManagerGrid` component, responsible for displaying files in a tree-like folder structure with selection and action capabilities, was commented out.
*   **Restoration and Active Development (1/17/2026, 11:47:00 AM)**: The component was fully uncommented and restored. It features a tree logic to organize files and folders based on their `title` path, checkbox-based selection for individual files and folders (with indeterminate states), and actions like download and delete, including a `DeleteModal` for confirmation.

**File: `c:\Users\91965\Desktop\MikeLegal\clm-frontend\apps\MikeCLM\src\utils\functions\useOnlineStatus.ts`**
*   **New Utility Hook (1/17/2026, 1:54:26 PM)**: A new custom React hook, `useOnlineStatus`, was created. This hook provides a state variable (`isOnline`) that reflects the browser's current online/offline status, utilizing `window.addEventListener` for real-time updates and includes a guard for server-side rendering environments.

**Patterns and Recurring Elements:**
*   **Ant Design (antd) UI Library**: A prominent recurring element is the extensive use of Ant Design components (Input, Button, Select, Pagination, Checkbox, Dropdown, Divider, Badge, message) across `Files.tsx` and `Calendar.tsx`, indicating a consistent UI framework.
*   **React Hooks for State and Lifecycle Management**: `useState`, `useMemo`, `useEffect`, `useRef`, and `useSearchParams` are frequently employed patterns for managing component state, optimizing performance, handling side effects, accessing DOM elements, and interacting with URL parameters.
*   **Redux for Global State Management**: The presence of `useSelector` and `useDispatch` in `Calendar.tsx` and the later addition in `Files.tsx` (for error handling) points to a Redux-based state management strategy for application-wide concerns.
*   **Modular Component Design**: The separation of concerns is evident with `Files.tsx` handling the overall file view and `FileManagerGrid.tsx` focusing on the display logic, and `CalendarModule` being an independent component integrated into `Calendar.tsx`.
*   **Iterative Development and Refactoring**: The pattern of commenting out large blocks of code, then re-introducing and refining them (especially in `Files.tsx`), suggests an active and iterative development process, likely involving transitions from mock data to live API integration.
*   **API Integration with Axios**: The use of `axios` for fetching data from a `ROOT_URL` in `Files.tsx` signifies a clear pattern of backend communication for data retrieval, requiring authorization headers.
*   **Shared Utilities**: Imports from `@mike-clm/shared` for utilities like `setCalendarFilters`, `setFilterApplied`, `setTeamFilterKeys`, `setError`, `useUserData`, and `convertDate` indicate a shared codebase for common functionalities and Redux slices across the application.
*   **Network Status Awareness**: The introduction of `useOnlineStatus` suggests future features might consider the user's network connectivity.

## 1:43:00 PM
The code changes primarily occurred between the late evening of January 17, 2026, and the early afternoon of January 18, 2026, indicating a focused development period. The most significant theme is a **major refactoring and enhancement of the ERP system to specialize in real estate transactions and improve accounting features**.

Here's a file-specific summary:

**c:\Users\91965\Desktop\SALES_ERP\server.js**
*   **Timestamp:** 1/17/2026, 5:23:52 PM (initial state), 1/18/2026, 11:45:36 AM, 1/18/2026, 11:46:11 AM, 1/18/2026, 1:14:48 PM, 1/18/2026, 1:16:55 PM.
*   **Changes:** The server setup remained largely consistent throughout the logs. The main update was the addition of `chartOfAccountRoutes` in the API routes section at `/api/chart-of-accounts` on January 18th, indicating the integration of a new core accounting module. Multiple entries show identical code, suggesting frequent saves without functional changes.

**c:\Users\91965\Desktop\SALES_ERP\models\Item.js**
*   **Timestamp:** 1/18/2026, 12:54:50 AM
*   **Changes:** Underwent a massive overhaul. The previous generic item schema was completely commented out and replaced with a new schema tailored for real estate properties.
    *   **New Fields:** Introduced specific fields like `propertyType` (enum: Plot, Flat, Shop, Office, etc.), `projectName`, `location` (address, city, state, pincode, landmark), `area` (plotArea, builtUpArea, carpetArea, unit), `dimensions` (length, width, facing), `ratePerUnit`, `totalPrice`, `bookingAmount`, `status` (enum: Available, Booked, Sold, etc.), `floorNumber`, `totalFloors`, `bedrooms`, `bathrooms`, `parking`, `amenities`, `description`, `legalDetails` (reraNumber, surveyNumber, plotNumber, khataNumber), `images`, and `documents`.
    *   **Stock Management:** `openingStock` and `currentStock` were adjusted, with `currentStock` defaulting to `openingStock` or 1.
    *   **Pricing:** `sellingPrice` and `purchasePrice` were replaced by `ratePerUnit` and `totalPrice`.
    *   **Indexing:** New indexes were added for `status`, `propertyType`, and `location.city` to support efficient querying of real estate properties.

**c:\Users\91965\Desktop\SALES_ERP\routes\items.js**
*   **Timestamp:** 1/18/2026, 12:55:26 AM
*   **Changes:** A complete rewrite from a generic CRUD factory pattern to direct route handler implementations.
    *   **New Endpoint:** Added `/for-sales` to fetch items specifically for sales/purchase dropdowns, filtering by `showInSales`, `isActive`, and `status` ('Available', 'Ready to Move').
    *   **Enhanced Filtering:** The `GET /` endpoint now supports filtering by `projectName`, `propertyType`, `status`, and `isActive` in addition to existing filters.
    *   **CRUD Logic Integration:** The `create` and `update` endpoints now handle the complex real estate-specific fields defined in the `Item` model, including logic to update `currentStock` and `status`.
    *   **Authorization:** The `user-panel` role was added to `getAll`, `getOne`, and `for-sales` endpoints, suggesting a new user interface or client access level.
    *   **Validation:** The explicit `itemValidation` middleware was removed, implying validation might be handled within the route logic or by Mongoose schema validation.
    *   **Socket Notifications:** `sendNotification` is used for item creation.

**c:\Users\91965\Desktop\SALES_ERP\models\Purchase.js**
*   **Timestamp:** 1/18/2026, 12:56:24 AM
*   **Changes:** Underwent significant expansion. The previous schema was commented out.
    *   **Purchase Items:** `purchaseItemSchema` now references `Item` by `itemId` and includes real estate-specific details like `propertyType`, `projectName`, and `area`. `qty` min value changed to 1.
    *   **Vendor Details:** Added `vendorContact` (phone, email, address).
    *   **Financial Details:** Introduced `cgst`, `sgst`, `igst` for detailed GST tracking, `paymentStatus` (Pending, Partial, Paid), `amountPaid`, `balanceAmount`, and additional `paymentMode` options.
    *   **Notes:** A `notes` field was added.
    *   **Auto-generation:** A static method `generatePurchaseNo` was added to automatically generate purchase numbers.
    *   **Indexing:** New indexes for `paymentStatus` and `items.itemId` were added.

**c:\Users\91965\Desktop\SALES_ERP\routes\purchases.js**
*   **Timestamp:** 1/18/2026, 12:57:10 AM
*   **Changes:** Rewritten from a generic CRUD factory, similar to `items.js`.
    *   **Enhanced Filtering:** The `GET /` endpoint gained filters for `paymentStatus`, `isActive`, and date ranges (`fromDate`, `toDate`). Populate options were expanded to include item details.
    *   **Create/Update Logic:** The `create` endpoint now automatically generates `purchaseNo` if not provided, validates and enriches `items` (potentially creating new `Item` entries if a new property is being purchased), and updates item `currentStock`. The `update` endpoint handles reverting old item stock and updating new item stock based on changes.
    *   **Payment Updates:** A new `PATCH /:id/payment` route was introduced to specifically handle updates to `amountPaid` and `paymentMode`.
    *   **Authorization:** The `user-panel` role was added to `getAll`, `getOne` endpoints.
    *   **Socket Notifications:** `sendNotification` is used for purchase creation and updates.

**c:\Users\91965\Desktop\SALES_ERP\models\Sales.js**
*   **Timestamp:** 1/18/2026, 12:58:38 AM
*   **Changes:** Similar to `Purchase.js`, the schema was greatly expanded from a commented-out prior version.
    *   **Sales Items:** `salesItemSchema` now references `Item` by `itemId` and includes real estate-specific details like `propertyType`, `projectName`, and `area`. `qty` min value changed to 1.
    *   **Customer Details:** Added `customerContact` (phone, email, address).
    *   **Financial Details:** Introduced `cgst`, `sgst`, `igst`, `paymentStatus` (Pending, Partial, Paid), `amountPaid`, `balanceAmount`, and expanded `paymentMode` options to include 'EMI'.
    *   **Notes:** A `notes` field was added.
    *   **Auto-generation:** A static method `generateInvoiceNo` was added to automatically generate invoice numbers.
    *   **Indexing:** New indexes for `paymentStatus` and `items.itemId` were added.

**c:\Users\91965\Desktop\SALES_ERP\routes\sales.js**
*   **Timestamp:** 1/18/2026, 12:59:07 AM
*   **Changes:** Rewritten from a generic CRUD factory, similar to `purchases.js`.
    *   **Enhanced Filtering:** The `GET /` endpoint gained filters for `paymentStatus`, `isActive`, and date ranges (`fromDate`, `toDate`). Populate options were expanded to include item details.
    *   **Create/Update Logic:** The `create` endpoint now automatically generates `invoiceNo`, validates `items` (checking if an item is already sold), and crucially updates the `Item`'s `status` to 'Sold' or 'Booked' and sets `currentStock` to 0. The `update` endpoint includes logic to restore old item status and stock when items are changed, then update new items.
    *   **Payment Updates:** A new `PATCH /:id/payment` route was introduced for payment updates, also updating the related `Item`'s status and stock.
    *   **Authorization:** The `user-panel` role was added to `getAll`, `getOne` endpoints.
    *   **Socket Notifications:** `sendNotification` is used for sales creation and updates.

**c:\Users\91965\Desktop\SALES_ERP\models\AccountGroup.js**
*   **Timestamp:** 1/18/2026, 1:00:55 AM
*   **Changes:** Significant update from a commented-out previous version.
    *   **Chart of Accounts Integration:** Added `chartOfAccountId` referencing a new `ChartOfAccount` model.
    *   **New Fields:** Introduced `pan`, `creditLimit`, expanded `defaultPaymentMode` to include 'UPI' and 'Cheque'.
    *   **Contact & Balance:** Added a `contact` object (phone, email, address, city, state, pincode) and `openingBalance` object (amount, type).
    *   **Indexing:** A new index for `chartOfAccountId` was added.

**c:\Users\91965\Desktop\SALES_ERP\routes\accountGroups.js**
*   **Timestamps:** 1/18/2026, 1:01:39 AM, 1/18/2026, 1:05:58 AM.
*   **Changes:** Rewritten from a generic CRUD factory.
    *   **Chart of Accounts Interaction:** `create` and `update` endpoints now validate the existence of the referenced `ChartOfAccount`.
    *   **Enhanced Filtering:** The `GET /` endpoint supports filtering by `chartOfAccountId` and `isActive`. Populate options were expanded to include Chart of Account details.
    *   **New Endpoint:** Added a `PATCH /:id/toggle-status` route to switch the `isActive` status of an account group.
    *   **Authorization:** The `user-panel` role was added to `getAll`, `getOne` endpoints.
    *   The 1:05:58 AM timestamp shows identical code to the 1:01:39 AM version, indicating a save.

**c:\Users\91965\Desktop\SALES_ERP\routes\chartOfAccounts.js**
*   **Timestamps:** 1/18/2026, 11:47:04 AM (initial creation), 1/18/2026, 11:47:13 AM, 1/18/2026, 1:12:33 PM, 1/18/2026, 1:13:30 PM, 1/18/2026, 1:13:35 PM, 1/18/2026, 1:14:17 PM, 1/18/2026, 1:17:15 PM, 1/18/2026, 1:17:25 PM, 1/18/2026, 1:20:10 PM.
*   **Changes:**
    *   **Initial Creation:** The file was initially created on January 18th at 11:47:04 AM, establishing CRUD routes (`getAllGroups`, `getGroup`, `createGroup`, `updateGroup`, `deleteGroup`) for Chart of Accounts, utilizing a `chartOfAccountController`.
    *   **Authorization:** All routes are protected by `authenticate` middleware, and further `authorize` roles are defined (e.g., 'admin', 'branch', 'user-panel').
    *   **Temporary Change:** At 1:17:25 PM, the `GET /` (getAllGroups) route was temporarily commented out, then restored at 1:20:10 PM.
    *   Multiple identical code entries are present, indicating frequent saves.

**Key Patterns and Recurring Elements:**

1.  **Real Estate Specialization:** The most prominent pattern is the transformation of the ERP into a real estate management system, specifically seen in the `Item` model (now representing properties) and the intricate logic in `purchases.js` and `sales.js` to handle property acquisition, sales, stock, and status updates.
2.  **Move from Generic CRUD to Custom Logic:** Several route files (Items, Purchases, Sales, Account Groups) were refactored from using a generic `createCRUDController` to implementing direct, often complex, CRUD logic. This suggests a need for more tailored business rules, validations, and interactions with other models.
3.  **Enhanced Accounting/Financial Modules:** The `AccountGroup` model received substantial financial and contact detail enhancements, and `server.js` was updated to include `ChartOfAccount` routes, indicating a more robust accounting backend.
4.  **Improved Data Management and Filtering:** Across multiple API routes, filtering capabilities were greatly expanded to include new real estate and financial-specific criteria, alongside consistent use of pagination utilities.
5.  **Role-Based Access Control Expansion:** The `authorize` middleware is consistently used, and the addition of the `user-panel` role across various `GET` endpoints points to the development of a user-facing dashboard or application.
6.  **Real-time Notifications:** The integration of socket notifications for significant events (item created, purchase/sale created/updated) in `items.js`, `purchases.js`, and `sales.js` highlights a focus on real-time communication within the system.
7.  **Auto-Generation of IDs:** `Purchase` and `Sales` models now include static methods to automatically generate unique `purchaseNo` and `invoiceNo`, improving data consistency.
8.  **Frequent Saving:** The large number of log entries with identical or minimal changes in `server.js` and `routes\chartOfAccounts.js` indicates a development workflow with very frequent saves.

## 2:42:56 PM
The code changes primarily focus on enhancements and refactoring within the `MikeCLM` frontend application, particularly in file management and calendar functionalities, with a noticeable shift towards API integration and robust state management.

**File-Specific Updates:**

1.  **`c:\Users\91965\Desktop\MikeLegal\clm-frontend\apps\MikeCLM\src\components\Contracts\Files\Files.tsx`**
    *   **Initial State (1/16/2026, 3:08:21 PM):** The `Files` component was responsible for displaying, searching, sorting, paginating, downloading, and deleting contract files. It used React state (`useState`, `useMemo`) for managing UI elements like search text, selected items, pagination, and sorting order. File data was initially hardcoded as mock `FilesListItem` objects. Ant Design components were heavily utilized for UI.
    *   **Debugging & Minor Additions (1/16/2026, 6:00:06 PM - 1/16/2026, 6:00:25 PM):** Small changes were made to retrieve `access_token` from `localStorage` and log it to the console, likely for debugging purposes.
    *   **Major Refactor to API Integration (1/17/2026, 11:43:50 AM):** This was a significant update where the component transitioned from using mock data to fetching actual data from an API.
        *   The hardcoded `files` state was replaced with an empty array.
        *   New React hooks (`useEffect`, `useSearchParams`) and the `axios` library were imported.
        *   An `useEffect` hook was introduced to fetch files from `${ROOT_URL}/contract-documents` based on a `document_id` obtained from URL search parameters. This API call included an `Authorization` header with the `access_token`.
        *   Error handling for API calls using `message.error` was added.
        *   The previous local state for files was effectively replaced by data fetched from the backend.
    *   **Subsequent Refinements and New Imports (1/17/2026, 1:49:00 PM - 1/17/2026, 3:49:52 PM):** This period shows a series of updates, often involving commenting out previous code blocks (possibly for temporary disabling or as a versioning method) while adding new features to the active code.
        *   Imports for `useRef`, `useOnlineStatus` (a custom hook), `useDispatch`, `setError`, and `useUserData` (from `@mike-clm/shared`) were added, indicating an expansion of features including online status detection and deeper Redux integration for error handling and user data.
        *   A `LoaderType` enum was introduced, suggesting plans for more granular loading state management.
        *   The `FilesListItem` interface remained consistent, but new types like `UploadStatusItem` were added later (1/17/2026, 4:13:59 PM), hinting at upcoming upload functionality.
    *   **Final Stage (1/17/2026, 3:53:50 PM - 1/17/2026, 4:13:59 PM):** Additional utilities like `convertDate` from `@mike-clm/shared` were imported.

2.  **`c:\Users\91965\Desktop\MikeLegal\clm-frontend\apps\MikeCLM\src\containers\Calendar\Calendar.tsx`**
    *   **Initial State (1/16/2026, 5:08:58 PM):** The `Calendar` container managed calendar event filters (`pendingFilters`, `pendingTypeFilters`) using React state and integrated with Redux (`useSelector`, `useDispatch`) for global state management. It defined a set of `allFilters` for different contract event types. The `CalendarModule` component was initially commented out, effectively disabling the main calendar display.
    *   **Activation of Calendar Module (1/16/2026, 5:09:13 PM):** The `CalendarModule` component was uncommented, making it an active part of the Calendar UI and passing down necessary props for filtering and event display.

3.  **`c:\Users\91965\Desktop\MikeLegal\clm-frontend\apps\MikeCLM\src\components\Contracts\Files\FileManagerGrid.tsx`**
    *   **Initial State (1/17/2026, 11:44:29 AM):** This component was initially fully commented out. The commented code revealed a sophisticated file management grid capable of displaying files in a hierarchical folder-like structure, handling file/folder selection, and integrating with delete/edit/download actions via modals. It derived its file/folder tree structure from the `filesData` prop using `useMemo`.
    *   **Activation (1/17/2026, 11:47:00 AM):** The entire `FileManagerGrid` component was uncommented, bringing its advanced file/folder display and interaction capabilities online.

4.  **`c:\Users\91965\Desktop\MikeLegal\clm-frontend\apps\MikeCLM\src\utils\functions\useOnlineStatus.ts`**
    *   **New Utility Hook (1/17/2026, 1:54:26 PM):** A new utility file was created to introduce `useOnlineStatus`, a custom React hook. This hook provides a stateful value `isOnline` that reflects the browser's network connectivity, updating it based on `window.online` and `window.offline` events. It also includes a check for server-side rendering environments.

**Timestamps of Significant Changes:**

*   **1/17/2026, 11:43:50 AM:** Major architectural shift in `Files.tsx` from mock data to API integration using `axios` and `useEffect`.
*   **1/17/2026, 11:47:00 AM:** Activation of the `FileManagerGrid.tsx` component, introducing complex file/folder tree rendering and interaction.
*   **1/17/2026, 1:54:26 PM:** Creation of the `useOnlineStatus` utility hook.
*   **1/17/2026, throughout the afternoon:** Continuous integration of new hooks (`useRef`, `useOnlineStatus`), Redux actions (`setError`), and data utilities (`convertDate`, `useUserData`) into `Files.tsx`, along with new type definitions (`LoaderType`, `UploadStatusItem`).

**Patterns and Recurring Elements:**

*   **Ant Design:** Consistent use of Ant Design components for a unified UI across different parts of the application.
*   **React Hooks:** Heavy reliance on `useState`, `useMemo`, `useEffect` for managing component state, performance optimization, and side effects. `useRef` and custom hooks (`useOnlineStatus`) are also introduced.
*   **Redux Integration:** The use of `useSelector`, `useDispatch`, and Redux actions (`setCalendarFilters`, `setFilterApplied`, `setTeamFilterKeys`, `setError`, `useUserData` from `@mike-clm/shared`) indicates a strong commitment to centralized state management.
*   **API-Driven Development:** A clear pattern of moving from hardcoded/mock data to fetching data from a backend API using `axios`, along with handling authentication (`access_token`).
*   **Modular Component Design:** Components like `Files` and `FileManagerGrid` are structured to handle specific UI and data logic, often with a clear separation of concerns.
*   **Iterative Development/Experimentation:** The frequent commenting/uncommenting of large code blocks, particularly in `Files.tsx` and `FileManagerGrid.tsx`, suggests an iterative development process, possibly involving temporary disabling of features or testing alternative implementations.
*   **Debugging:** Repeated `console.log` statements for `access_token` point to ongoing debugging efforts related to authentication or API calls.
*   **Shared Utilities:** The `@mike-clm/shared` library is a recurring import source for Redux actions, hooks, and utility functions, indicating a shared codebase for common functionalities.